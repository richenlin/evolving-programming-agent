# 简化模式 (Simple Mode)

适用于问题修复、代码重构、代码审查场景。

## 状态文件

| 文件 | 用途 | 模板 |
|------|------|------|
| `progress.txt` | 会话进度日志 | `templates/progress.txt` |
| `feature_list.json` | 任务清单 | `templates/feature_list.json` |

## 工作流程

### 1. 任务拆解（复杂修复必须首先执行）

**目的**: 将复杂修复/重构拆解为可验证的小步骤

**关键流程**:
1. **先用 `sequential-thinking` 深度分析问题**，归纳总结后再生成 todos
2. 生成 todos 后**必须同步写入 `feature_list.json`**

**拆解原则**:
- 每个步骤必须**非常小且可测试**
- 每个步骤有**明确的开始与结束**
- 每个步骤**专注于一个问题**
- 步骤按**实现顺序排列**

**何时需要拆解**:
- 修复涉及多个文件
- 重构范围较大
- 问题根因不明确，需要逐步排查

**拆解示例**:
```
❌ 错误: "修复登录失败问题"
✓ 正确:
  1. 复现问题，确认错误日志
  2. 检查前端请求参数
  3. 检查后端接口响应
  4. 定位具体失败点
  5. 修复代码
  6. 验证修复有效
  7. 检查回归
```

### 2. 状态检查（每次会话必须执行）

**目的**: 了解上一步完成情况和遗留问题

```
检查 progress.txt 是否存在
    ├─ 存在 → 执行状态检查
    └─ 不存在 → 创建新的 progress.txt
```

**检查内容**:
```bash
# 读取进度日志 - 了解历史修复记录、遗留问题
cat progress.txt
```

**检查后行动**:
- 从"下一步"继续未完成的工作
- 优先处理"遇到的问题"中的遗留项
- 了解历史修复方案，避免重复踩坑

### 3. 问题修复循环

```
任务拆解（如需要）
         → 状态检查
         → 理解问题
         → 阅读相关代码 + 复现问题
         → 分析根本原因（非表面症状）
         → 制定方案（多方案时说明取舍）
         → 实施修改（最小化改动）
         → 验证测试（确保修复有效无副作用）
         → 状态更新
         → git commit
         → 【进化检查】(参考 evolution-check.md)
```

> **重要**: 每个修复循环结束后必须执行进化检查，详见 `evolution-check.md`

### 4. 状态更新（每个步骤完成后必须执行）

**目的**: 给下一步做指引

**progress.txt 更新内容**:
```
================================================================================
SESSION: YYYY-MM-DD HH:MM
================================================================================
## 本次完成
- [x] 具体修复/重构的内容描述

## 当前状态
- 问题是否完全解决
- 代码当前状态

## 下一步
- 下个会话应该做什么（具体、可执行）
- 如果问题未完全解决，说明剩余工作

## 遇到的问题
- 问题描述 + 临时方案或待解决标记
- 修复过程中发现的其他问题
```

**更新时机**:
- 每完成一个修复/重构步骤
- 每次 git commit 前
- 会话结束前

## 测试验证

| 类型 | 方法 |
|------|------|
| 编译 | 运行构建命令 |
| 单测 | 运行现有测试 |
| 功能 | curl/手动验证 |
| 回归 | 确认未破坏现有功能 |

## 错误处理

1. 分析失败原因
2. 尝试不同方案（最多3次）
3. 连续失败：回退 + 记录到 progress.txt + 报告用户

## 5. 进化检查（任务完成后必须执行）

**目的**: 将有价值的经验提取并存储到知识库

**执行时机**: 每个修复循环结束后、会话结束前

**检查流程**:
```
检查 .opencode/.evolution_mode_active 是否存在
    ├─ 存在 → 进化模式激活，执行经验提取
    │       ├─ 分析本次会话是否有可提取经验
    │       ├─ 满足触发条件 → 运行 trigger_detector.py
    │       └─ 调用 knowledge_summarizer.py 存储
    └─ 不存在 → 检查是否满足被动触发条件
            ├─ 复杂修复(尝试>1次) → 执行经验提取
            ├─ 用户明确要求"记住" → 执行经验提取
            └─ 否则 → 正常结束
```

**详细步骤**: 参考 `@load modules/evolution-check.md`
