# 完整模式 (Full Mode)

适用于新建项目和功能开发场景。

## 状态文件

| 文件 | 用途 | 模板 |
|------|------|------|
| `SOLUTION.md` | 架构设计、技术选型 | - |
| `TASK.md` | 任务拆解、实现步骤 | - |
| `feature_list.json` | 功能状态跟踪（按实现顺序排列） | `templates/feature_list.json` |
| `progress.txt` | 会话进度日志 | `templates/progress.txt` |

## 工作流程

### 1. 任务拆解（新任务必须首先执行）

**目的**: 将用户需求拆解为可执行的小任务

**关键流程**:
1. **先用 `sequential-thinking` 深度分析需求**，归纳总结后再生成 todos
2. 生成 todos 后**必须同步写入 `feature_list.json`**

**拆解原则**:
- 每个任务必须**非常小且可测试**
- 每个任务有**明确的开始与结束**
- 每个任务**专注于一个问题**
- 任务按**实现顺序排列**

**拆解流程**:
```
用户需求 → sequential-thinking 深度分析（归纳总结）
         → 分析需求完整性
         → 识别技术依赖关系
         → 拆解为原子任务（每个任务 < 30分钟）
         → 按依赖顺序排列
         → 写入 feature_list.json（与 todos 同步）
```

**任务粒度示例**:
```
❌ 错误: "实现用户认证系统"
✓ 正确:
  1. 创建 User 数据模型
  2. 实现密码哈希工具函数
  3. 创建注册 API 端点
  4. 创建登录 API 端点
  5. 实现 JWT token 生成
  6. 添加认证中间件
  7. 编写注册功能测试
  8. 编写登录功能测试
```

### 2. 状态检查（每次会话必须执行）

**目的**: 了解上一步完成情况和遗留问题

```
检查 progress.txt 和 feature_list.json 是否存在
    ├─ 存在 → 执行状态检查
    └─ 不存在 → 进入初始化流程
```

**检查内容**:
```bash
# 读取进度日志 - 了解上次完成了什么、遗留什么问题
cat progress.txt

# 读取功能列表 - 了解哪些功能待开发、哪些进行中
cat feature_list.json
```

**检查后行动**:
- 从 `progress.txt` 的"下一步"继续
- 优先处理"遇到的问题"中的遗留项
- 选择 `feature_list.json` 中**第一个** `pending` 任务（已按顺序排列）

### 3. 初始化（新项目首次）

```
分析需求 → 生成 SOLUTION.md
         → 生成 TASK.md
         → 任务拆解 → 写入 feature_list.json
         → 创建 progress.txt
         → 目录结构 + git init + 首次 commit
```

### 4. 开发循环

```
状态检查 → 选择任务(第一个pending)
         → 实现功能(参考TASK.md)
         → 验证测试(失败则修复，3次失败则回退)
         → 状态更新
         → git commit
         → 【进化检查】(参考 evolution-check.md)
         → 继续下一任务或结束
```

> **重要**: 每个开发循环结束后必须执行进化检查，详见 `evolution-check.md`

### 5. 状态更新（每个步骤完成后必须执行）

**目的**: 给下一步做指引

**progress.txt 更新内容**:
```
## 本次完成
- [x] 具体完成的任务描述

## 当前状态
- 项目整体进度
- 已完成的功能列表

## 下一步
- 下个会话应该做什么（具体、可执行）
- 优先级最高的待办事项

## 遇到的问题
- 问题描述 + 临时方案或待解决标记
```

**feature_list.json 更新内容**:
- 完成的功能: `status` → `"completed"`, 填写 `completed_at`
- 进行中的功能: `status` → `"in_progress"`
- 被阻塞的功能: `status` → `"blocked"`, 在 `notes` 说明原因

## 代码实现规范

**实现前**: 阅读现有代码，确认技术方案
**实现中**: 遵循现有风格，一次只改一个功能点
**实现后**: 运行测试验证，检查回归

## 错误处理

1. 分析失败原因
2. 尝试不同方案（最多3次）
3. 连续失败：回退 + 记录到 progress.txt + 报告用户

## 6. 进化检查（任务完成后必须执行）

**目的**: 将有价值的经验提取并存储到知识库

**执行时机**: 每个开发循环结束后、会话结束前

**检查流程**:
```
检查 .opencode/.evolution_mode_active 是否存在
    ├─ 存在 → 进化模式激活，执行经验提取
    │       ├─ 分析本次会话是否有可提取经验
    │       ├─ 满足触发条件 → 运行 trigger_detector.py
    │       └─ 调用 knowledge_summarizer.py 存储
    └─ 不存在 → 检查是否满足被动触发条件
            ├─ 复杂问题(尝试>1次) → 执行经验提取
            ├─ 用户明确要求"记住" → 执行经验提取
            └─ 否则 → 正常结束
```

**详细步骤**: 参考 `@load modules/evolution-check.md`
